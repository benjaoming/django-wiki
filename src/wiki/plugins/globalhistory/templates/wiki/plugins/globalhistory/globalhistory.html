{% extends "wiki/base.html" %}
{% load wiki_tags i18n humanize %}

{% block wiki_pagetitle %}{% trans "Global history" %}{% endblock %}

{% block wiki_contents %}

<h1 class="page-header">{% trans "Global history" %}</h1>

{% spaceless %}
<div class="row">
  <div class="navbar-default lead col-xs-12">

    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#gh-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      {% with paginator.object_list.count as cnt %}
        {% blocktrans %}List of all <strong>{{ cnt }} changes</strong> in the wiki.{% endblocktrans %}
      {% endwith %}
    </div>

    <div id="gh-collapse" class="navbar-collapse collapse">
      <form class="navbar-form navbar-right" method="GET">
        <div class="input-group">
          <input type="search" class="form-control search-query" name="q" placeholder="{% trans "Filter..." %}" value="{{ filter }}"/>
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">
              <span class="fa fa-filter"></span>
            </button>
          </span>
        </div>
      </form>
      <div class="navbar-btn navbar-right">
        <a class="btn btn-default"
          {% if only_last == "1" %}
            href="/_plugin/globalhistory/0/?{% url_querystring_replace %}">
            {% trans "Show all revisions of all articles" %}
          {% else %}
            href="/_plugin/globalhistory/1/?{% url_querystring_replace %}">
            {% trans "Show last revision of every article" %}
          {% endif %}
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row">
  {% if revisions %}
    <table class="table table-striped table-condensed table-hover">
      <thead>
        <tr>
          <th>{% trans "Revision" %}</th>
          <th>{% trans "Article" %}</th>
        </tr>
      </thead>

      <tbody>
        {% for revision in revisions %}
          <tr>
            <td>
              <span style="white-space:nowrap">#{{ revision.revision_number }}: {{ revision.modified }}</span>
              {% trans "by" %}&nbsp;{% spaceless %}
              {% if revision.user %}{{ revision.user }}
              {% else %}{% if revision.article|can_moderate:user %}{{ revision.ip_address|default:"anonymous (IP not logged)" }}
              {% else %}{% trans "anonymous (IP logged)" %}{% endif %}{% endif %}
              {% endspaceless %}
              {% if revision.deleted %}
                <span class="badge badge-important">{% trans "deleted" %}</span>
              {% endif %}
              {% if revision.previous_revision.deleted and not revision.deleted %}
                <span class="badge badge-success">{% trans "restored" %}</span>
              {% endif %}
              {% if revision.locked %}
                <span class="badge">{% trans "locked" %}</span>
              {% endif %}
              {% if revision.previous_revision.locked and not revision.locked %}
                <span class="badge">{% trans "unlocked" %}</span>
              {% endif %}
              <br>
              {% if revision.user_message %}
                {{ revision.user_message }}
              {% elif revision.automatic_log %}
                {{ revision.automatic_log }}
              {% else %}
                ({% trans "no log message" %})
              {% endif %}
            </td>
            <td>
              <a href="{% url 'wiki:get' revision.article.pk %}" class="btn btn-primary btn-xs">{% trans "Article "%}"{{ revision.article }}"</a>
              <br>
              <a href="{% url 'wiki:history' revision.article.pk %}" class="btn btn-info btn-xs">{% trans "Article history" %}</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="alert alert-info">
      {% trans "No changes to display !" %}
    </div>
  {% endif %}

  {% include "wiki/includes/pagination.html" %}
</div>
{% endspaceless %}
{% endblock %}
